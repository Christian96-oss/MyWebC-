@using MYWEB.Models
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    Layout = "~/Views/Shared/_LayoutMyPort.cshtml";
}
@{
    bool onlyAdmin = HttpContextAccessor.HttpContext.Session.GetString("level") != "user";
}
<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 mt-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-3">
                            <div class="d-flex">
                                <h2 class="text-dark"><i class="nav-icon fas fa-folder-open"></i> Project</h2>&nbsp;
                                <h2 class="text-dt">History</h2>
                                <div class="ml-3 mt-2">
                                    @if (onlyAdmin)
                                    {
                                        <button class="btn btn-primary btn-sm" onclick="addData()">
                                            <i class="fa fa-plus"></i> Add  Project
                                        </button>
                                        <button class="btn btn-sm btn-danger btn-sm" id="delete_select"><i class="fas fa-trash"></i> Delete Selected Data</button>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <label style="font-size:10pt; font-weight:bold;">Date From</label>
                                <input type="date" id="date_from" value="" class="form-control form-control-sm text-center" />
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <label style="font-size:10pt;font-weight:bold;">Date To</label>
                                <input type="date" id="date_to" value="" class="form-control form-control-sm text-center" />
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <div class="form-group">
                                    <label style="font-size:10pt;font-weight:bold;">Project Name</label>
                                    <select class="form-control form-control-sm text-center" id="select_pjname" style="width:100%;">
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <div class="form-group">
                                    <label style="font-size:10pt;font-weight:bold;">Made By</label>
                                    <select class="form-control form-control-sm text-center" id="select_made" style="width:100%;">
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <label style="font-size:10pt;"></label>
                                <div>
                                    <button id="btn_apply" name="btn_apply" class="btn btn-primary btn-sm btn-block mt-2"><i class="fa fa-search mr-1"></i>Apply </button>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-1 col-sm-6">
                                <label style="font-size:10pt;"></label>
                                <div>
                                    <button id="btn_reset" name="btn_reset" class="btn btn-sm btn-warning btn-block mt-2" onclick="window.location.reload()"><i class="fa fa-history mr-1"></i> </button>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <div class="form-group">
                                    <label style="font-size:10pt;font-weight:bold;">Platform</label>
                                    <select class="form-control form-control-sm text-center" id="select_platform" style="width:100%;">
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <div class="form-group">
                                    <label style="font-size:10pt;font-weight:bold;">Frontend</label>
                                    <select class="form-control form-control-sm text-center" id="select_frontend" style="width:100%;">
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <div class="form-group">
                                    <label style="font-size:10pt;font-weight:bold;">Backend</label>
                                    <select class="form-control form-control-sm text-center" id="select_backend" style="width:100%;">
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6">
                                <div class="form-group">
                                    <label style="font-size:10pt;font-weight:bold;">Database</label>
                                    <select class="form-control form-control-sm text-center" id="select_databases" style="width:100%;">
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-12">
                                <table class="table table-sm table-striped border" rules=none id="tbl_details_filter" style="font-size:8pt;">
                                    <thead>
                                        <tr class="text-center">
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="2%"><input type="checkbox" id="checkAll" onClick="toggle(this)" /> Check All</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Project Name</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Project Date</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Duration</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Platform</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Frontend</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Backend</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Database</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Made by</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Link Yt</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Link Drive</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Keterangan</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Referensi</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Berkas Project</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Date Insert</th>
                                            <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Last Update</th>
                                            @if (onlyAdmin)
                                            {
                                                <th class="font-calibri border-right align-middle text-center text-white" style="background-color:#1b6ec2" width="10%">Action</th>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody id="table_details">
                                    </tbody>
                                </table>
                                <div id="spinner_loading" class="text-center mt-2">
                                    <i class="fas fa-spinner fa-spin fa-lg" style="font-size:30pt;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modal_edit" class="modal fade" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color:#1b6ec2">
                <h5 class=" text-white"><i class="fa fa-info-circle mr-2"></i>Edit Project</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row ml-2 mr-2">
                    <div class="col-6">
                        <div class="card card-outline" id="scan">
                            <div class="row ml-2 mr-2">
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Project Name<span style="color: red; font-weight:bold;">*</span></label>
                                        <input class="form-control form-control-sm" type="text" id="pjnamex" maxlength="255" />
                                        <input type="text" id="id" class="form-control form-control-sm" hidden />
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Project Date<span style="color: red; font-weight:bold;">*</span></label>
                                        <input class="form-control form-control-sm" type="date" id="pjdatex" maxlength="255" />
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Duration<span style="color: red; font-weight:bold;">*</span></label>
                                        <input class="form-control form-control-sm" type="number" id="durationx" maxlength="255" />
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Platform<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="platformx" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Frontend<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="frontendx" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Backend<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="backendx" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Database<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="databasesx" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Made by<span style="color: red; font-weight:bold;">*</span></label>
                                        <textarea class="form-control form-control-sm" id="madex" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Link Yotube</label>
                                        <textarea class="form-control form-control-sm" id="pjytx" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card card-outline" id="manual">
                            <div class="row ml-2 mr-2">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Link Gdrive</label>
                                        <textarea class="form-control form-control-sm" id="pjgdx" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Keterangan</label>
                                        <textarea class="form-control form-control-sm" id="ketx" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Referensi</label>
                                        <textarea class="form-control form-control-sm" id="refx" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Upload<span style="color: red; font-weight:bold;">*</span></label>
                                        <div class="ml-1" id="file_section">
                                            <input type="file" name="file" accept=".jpg, .bmp, .png, .jfif, .word, .pdf, .pptx" id="actual-btn" hidden />
                                            <label for="actual-btn" class="actual-btn">Choose file</label>
                                            <span id="file-chosen" style="width:100%;">No file chosen</span>
                                            <button id="reset-btn" class="reset-btn" style="display: none;">Hapus</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <div class="ml-1">
                                            <img id="img-preview" src="" style="width:5rem; height:5rem; display:none;" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <label style="font-size:12pt;"></label>
                        <div class="row d-flex justify-content-center">
                            <div class="col-3 mx-auto">
                                <button class="btn btn-primary btn-block" id="btn_lead" onclick="verify_save()"><i class="fas fa-save"></i> Save </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modal_add" class="modal fade" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color:#1b6ec2">
                <h5 class=" text-white"><i class="fa fa-info-circle mr-2"></i>Add Project</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row ml-2 mr-2">
                    <div class="col-6">
                        <div class="card card-outline" id="scan">
                            <div class="row ml-2 mr-2">
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Project Name<span style="color: red; font-weight:bold;">*</span></label>
                                        <input class="form-control form-control-sm" type="text" id="pjnamex2" maxlength="255" />
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Project Date<span style="color: red; font-weight:bold;">*</span></label>
                                        <input class="form-control form-control-sm" type="date" id="pjdatex2" maxlength="255" />
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Duration<span style="color: red; font-weight:bold;">*</span></label>
                                        <input class="form-control form-control-sm" type="number" id="durationx2" maxlength="255" />
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Platform<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="platformx2" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Frontend<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="frontendx2" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Backend<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="backendx2" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Database<span style="color: red; font-weight:bold;">*</span></label>
                                        <select class="form-control form-control-sm text-center" id="databasesx2" style="width:100%;"></select>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Made by<span style="color: red; font-weight:bold;">*</span></label>
                                        <textarea class="form-control form-control-sm" id="madex2" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Link Yotube</label>
                                        <textarea class="form-control form-control-sm" id="pjytx2" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card card-outline" id="manual">
                            <div class="row ml-2 mr-2">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Link Gdrive</label>
                                        <textarea class="form-control form-control-sm" id="pjgdx2" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Keterangan</label>
                                        <textarea class="form-control form-control-sm" id="ketx2" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Referensi</label>
                                        <textarea class="form-control form-control-sm" id="refx2" maxlength="255" style="resize: vertical; min-height: 50px;"></textarea>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <label style="font-size:10pt; font-weight:bold;">Upload<span style="color: red; font-weight:bold;">*</span></label>
                                        <div class="ml-1" id="file_sectionn">
                                            <input type="file" name="file" accept=".jpg, .bmp, .png, .jfif, .word, .pdf, .pptx" id="actual-btnn" hidden />
                                            <label for="actual-btnn" class="actual-btnn">Choose file</label>
                                            <span id="file-chosenn" style="width:100%;">No file chosen</span>
                                            <button id="reset-btnn" class="reset-btnn" style="display: none;">Hapus</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group">
                                        <div class="ml-1">
                                            <img id="img-previeww" src="" style="width:5rem; height:5rem; display:none;" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <label style="font-size:12pt;"></label>
                        <div class="row d-flex justify-content-center">
                            <div class="col-3 mx-auto">
                                <button class="btn btn-primary btn-block" id="create_Data"><i class="fas fa-plus"></i> Add </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script src="~/lib/adminlte/plugins/chart.js/Chart.min.js"></script>
    <script src="~/lib/adminlte/plugins/chart.js/chartjs-plugin-datalabels@1.1.2.js"></script>
    <script>
        let isSearch = false;
        $(document).on('click', '.view-pdf-btn', function () {
            var pdfUrl = $(this).data('pdf-url');
            window.open(pdfUrl, '_blank');
        });

        //edit
        document.getElementById('actual-btn').addEventListener('change', function () {
            const file = this.files[0];
            const preview = document.getElementById('img-preview');
            const fileNameSpan = document.getElementById('file-chosen');

            if (file) {
                const fileType = file.type;
                const fileName = file.name;

                // Reset file preview and name
                preview.style.display = 'none';
                fileNameSpan.textContent = '';

                if (fileType.includes('image')) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    }
                    reader.readAsDataURL(file);
                } else if (fileType === 'application/pdf') {
                    preview.style.display = 'none';
                    fileNameSpan.textContent = fileName;
                } else {
                    preview.style.display = 'none';
                    fileNameSpan.textContent = 'Unsupported file type';
                }
            } else {
                fileNameSpan.textContent = 'No file chosen';
                preview.style.display = 'none';
            }
        });

        //add
        document.getElementById('actual-btnn').addEventListener('change', function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();

                document.getElementById('file-chosenn').textContent = file.name;
                if (file.type === 'application/pdf') {
                    // Jika file adalah PDF, tampilkan tautan untuk membuka file PDF
                    const pdfLink = document.createElement('a');
                    pdfLink.href = URL.createObjectURL(file);
                    pdfLink.textContent = 'View PDF';
                    pdfLink.target = '_blank'; // Buka di tab atau jendela baru
                    document.getElementById('pdf-preview-container').innerHTML = ''; // Bersihkan konten sebelumnya
                    document.getElementById('pdf-preview-container').appendChild(pdfLink);
                } else {
                    // Jika file bukan PDF, tampilkan pratinjau gambar
                    reader.addEventListener('load', function () {
                        const preview = document.getElementById('img-previeww');
                        preview.src = this.result;
                        preview.style.display = 'block';
                    });

                    reader.readAsDataURL(file);
                }
            }
        });

        function toggle(source) {
            checkboxes = document.getElementsByName('foo');
            for (var i = 0, n = checkboxes.length; i < n; i++) {
                checkboxes[i].checked = source.checked;
            }
        }

        $(document).ready(function () {

            $('#select_pjname').select2({
                placeholder: 'select project name',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetPjname0")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#select_made').select2({
                placeholder: 'select made by',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetMade0")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#select_platform').select2({
                placeholder: 'select platform',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetPlatform0")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#select_frontend').select2({
                placeholder: 'select frontend',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetFrontend0")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#select_backend').select2({
                placeholder: 'select backend',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetBackend0")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#select_databases').select2({
                placeholder: 'select databases',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetDatabases0")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            //add

            $('#platformx2').select2({
                placeholder: 'select platform',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetPlatformMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#frontendx2').select2({
                placeholder: 'select frontend',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetFrontendMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#backendx2').select2({
                placeholder: 'select backend',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetBackendMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#databasesx2').select2({
                placeholder: 'select databases',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetDatabasesMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            //edit

            $('#platformx').select2({
                placeholder: 'select platform',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetPlatformMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#frontendx').select2({
                placeholder: 'select frontend',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetFrontendMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#backendx').select2({
                placeholder: 'select backend',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetBackendMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            $('#databasesx').select2({
                placeholder: 'select databases',
                width: '100%',
                ajax: {
                    url: "@Url.Action("GetDatabasesMst")",
                    async: false,
                    data: function (params) {
                        return {
                            family: params.term,
                            //sector: 'none'
                        };
                    },
                    processResults: function (data) {
                        //console.log(data);
                        return {
                            results: data.items
                        }
                    },
                }
            });

            setTimeout(function () {
                $('button[name=btn_apply]').click();
            }, 1000);

            window.setTimeout(function () {
                location.reload();
            }, 900000);
        })

        $('button[name=btn_apply]').click(function () {
            pj_name = $("#select_pjname").val();
            made_by = $("#select_made").val();
            platform = $("#select_platform").val();
            frontend = $("#select_frontend").val();
            backend = $("#select_backend").val();
            databases = $("#select_databases").val();
            date_from = $('#date_from').val()
            date_to = $('#date_to').val()

            $("#table_details").html('');
            var table = $("#table_details");
            var table1 = $("#tbl_details_filter");
            $.ajax({
                url: "@Url.Action("GETPROJECT")",
                type: "POST",
                data: {
                    pj_name: pj_name,
                    made_by: made_by,
                    platform: platform,
                    frontend: frontend,
                    backend: backend,
                    databases: databases,
                    datefrom: date_from,
                    dateto: date_to
                },
                success: function (data) {
                    //console.log(data)
                    if (!isSearch)
                        isSearch = true;
                    else
                        table1.DataTable().destroy();
                    table.html(data);
                    table1.DataTable({
                        dom: 'lrtpi',
                        pagingType: 'numbers',
                        searching: false
                    });
                },
                complete: function () {
                    $('#spinner_loading').hide();
                }
            });
        })


        function btn_delete(id_pj) {

            if (id_pj == '') {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please Fill in All the requirement first !'
                })
            }
            else {
                Swal.fire({
                    title: 'Delete Project?',
                    text: "Are you sure for this action? ",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#28a745',
                    cancelButtonColor: '#dc3545',
                    confirmButtonText: 'Yes!',
                    cancelButtonText: 'No!',
                    showLoaderOnConfirm: true,
                    preConfirm: function () {
                        return new Promise(function (resolve, reject) {
                            $.ajax({
                                type: "POST",
                                url: "@Url.Action("DeleteProject", "Admin")",
                                data: {
                                    id_pj: id_pj
                                },
                                dataType: "json",
                                success: function () {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Success',
                                        text: 'Deleted Successfully !'
                                    })
                                    window.location.href = '@Url.Action("ProjectHistory", "Admin")';
                                },
                                complete: function () {
                                    $('#spinner_loading').hide();
                                }
                            });

                        })
                    }

                })

            }
        }

        $("#delete_select").click(function () {
            var selectedIDs = new Array();
            $('input:checkbox.select_item').each(function () {
                if ($(this).prop('checked')) {
                    selectedIDs.push({ id_pj: $(this).val() });
                }
            });
            console.log(selectedIDs) //ada datanya

            if (selectedIDs.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please Fill in All the requirement first !'
                })

            } else {
                Swal.fire({
                    title: 'Delete Project?',
                    text: "Are you sure tfor this action? ",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#28a745',
                    cancelButtonColor: '#dc3545',
                    confirmButtonText: 'Yes!',
                    cancelButtonText: 'No!',
                    showLoaderOnConfirm: true,
                    preConfirm: function () {
                        $.ajax({
                            type: "POST",
                            url: "@Url.Action("Delete_selected6", "Admin")",
                            data: JSON.stringify(selectedIDs),
                            dataType: "json",
                            contentType: "application/json",
                            success: function () {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Success',
                                    text: 'Delete Successfully !'
                                })
                                window.location.href = '@Url.Action("ProjectHistory", "Admin")';
                            },
                            complete: function () {
                                $('#spinner_loading').hide();
                            }
                        });
                    }
                })
            }

        });

        function btn_edit(id_pj, pjnamex, pjdatex, durationx, platform, frontend, backend, databases, madex, pjytx, pjgdx, ketx, refx, pj_zip) {
            $('#id').val(id_pj);
            $('#pjnamex').val(pjnamex);
            $('#pjdatex').val(pjdatex);
            $('#durationx').val(durationx);
            $('#platformx').empty()
            getPlatform(platform);
            $('#frontendx').empty()
            getFrontend(frontend);
            $('#backendx').empty()
            getBackend(backend);
            $('#databasesx').empty()
            getDatabases(databases);
            $('#madex').val(madex);
            $('#pjytx').val(pjytx);
            $('#pjgdx').val(pjgdx);
            $('#ketx').val(ketx);
            $('#refx').val(refx);
            // Menampilkan gambar yang diunggah
            if (pj_zip) {
                const fileType = pj_zip.split('.').pop().toLowerCase();
                if (fileType === 'pdf') {
                    $('#img-preview').hide();
                    $('#file-chosen').text(pj_zip);
                } else {
                    $('#img-preview').attr('src', '../project/' + pj_zip);
                    $('#img-preview').show();
                    $('#file-chosen').text('');
                }
            } else {
                $('#img-preview').hide();
                $('#file-chosen').text('No file chosen');
            }
            $("#modal_edit").modal('show');
        }

        $(document).ready(function () {
            $('#actual-btn').on('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        $('#img-preview').attr('src', e.target.result);
                        $('#img-preview').show();
                    };
                    reader.readAsDataURL(file);
                    $('#file-chosen').text(file.name);
                    $('#reset-btn').show();
                }
            });

            $('#reset-btn').on('click', function () {
                $('#actual-btn').val(null);
                $('#img-preview').attr('src', '').hide();
                $('#file-chosen').text('No file chosen');
                $(this).hide();
            });
        });

        function getPlatform(platform) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetProjPlatform")",
                data: {
                    platform: platform
                },
                success: function (data) {
                    if (data.platform !== '') {
                        $('#platformx').append(new Option(data.platform, data.platform, true, true)).trigger('change');
                    }
                }
            });
        }

        function getFrontend(frontend) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetProjFrontend")",
                data: {
                    frontend: frontend
                },
                success: function (data) {
                    if (data.frontend !== '') {
                        $('#frontendx').append(new Option(data.frontend, data.frontend, true, true)).trigger('change');
                    }
                }
            });
        }

        function getBackend(backend) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetProjBackend")",
                data: {
                    backend: backend
                },
                success: function (data) {
                    if (data.backend !== '') {
                        $('#backendx').append(new Option(data.backend, data.backend, true, true)).trigger('change');
                    }
                }
            });
        }

        function getDatabases(databases) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetProjDatabases")",
                data: {
                    databases: databases
                },
                success: function (data) {
                    if (data.databases !== '') {
                        $('#databasesx').append(new Option(data.databases, data.databases, true, true)).trigger('change');
                    }
                }
            });
        }

        function addData() {
            $('#modal_add').modal('show');
        }

        function verify_save() {
            var id_pj = $('#id').val();
            var pj_name = $('#pjnamex').val();
            var pj_date = $('#pjdatex').val();
            var duration = $('#durationx').val();
            var platform = $('#platformx').val();
            var frontend = $('#frontendx').val();
            var backend = $('#backendx').val();
            var databases = $('#databasesx').val();
            var made_by = $('#madex').val();
            var pj_yt = $('#pjytx').val();
            var pj_gd = $('#pjgdx').val();
            var keterangan = $('#ketx').val();
            var ref_by = $('#refx').val();
            var fileInput = $('#actual-btn')[0].files[0];

            console.log({
                id_pj: id_pj,
                pj_name: pj_name,
                pj_date: pj_date,
                duration: duration,
                platform: platform,
                frontend: frontend,
                backend: backend,
                databases: databases,
                made_by: made_by,
                pj_yt: pj_yt,
                pj_gd: pj_gd,
                keterangan: keterangan,
                ref_by: ref_by,
                fileInput: fileInput
            });

            if (pj_name == '' || pj_date == '' || duration == '' || platform == '' || frontend == '' || backend == '' || databases == '' || made_by == '') {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please Fill in All the requirement first !'
                });
            } else {
                Swal.fire({
                    title: 'Edit Project?',
                    text: "Are you sure for this action? ",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#28a745',
                    cancelButtonColor: '#dc3545',
                    confirmButtonText: 'Yes!',
                    cancelButtonText: 'No!',
                    showLoaderOnConfirm: true,
                    preConfirm: function () {
                        return new Promise(function (resolve, reject) {
                            var formData = new FormData();
                            formData.append('id_pj', id_pj);
                            formData.append('pj_name', pj_name);
                            formData.append('pj_date', pj_date);
                            formData.append('duration', duration);
                            formData.append('platform', platform);
                            formData.append('frontend', frontend);

                            formData.append('backend', backend);
                            formData.append('databases', databases);
                            formData.append('made_by', made_by);
                            formData.append('pj_yt', pj_yt);
                            formData.append('pj_gd', pj_gd);
                            formData.append('keterangan', keterangan);
                            formData.append('ref_by', ref_by);
                            if (fileInput) {
                                formData.append('file', fileInput);
                            }

                            $.ajax({
                                type: "POST",
                                url: "@Url.Action("UpdateProject", "Admin")",
                                data: formData,
                                processData: false,
                                contentType: false,
                                success: function () {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Success',
                                        text: 'Edit Successfully !'
                                    });
                                    window.location.href = '@Url.Action("ProjectHistory", "Admin")';
                                },
                                complete: function () {
                                    $('#spinner_loading').hide();
                                }
                            });

                        });
                    }
                });
            }
        }

        $("#create_Data").click(function () {
            var pjnamex = $('#pjnamex2').val();
            var pjdatex = $('#pjdatex2').val();
            var durationx = $('#durationx2').val();
            var platformx = $('#platformx2').val();
            var frontendx = $('#frontendx2').val();
            var backendx = $('#backendx2').val();
            var databasesx = $('#databasesx2').val();
            var madex = $('#madex2').val();
            var pjytx = $('#pjytx2').val();
            var pjgdx = $('#pjgdx2').val();
            var ketx = $('#ketx2').val();
            var refx = $('#refx2').val();
            var fileInput = $('#actual-btnn')[0].files[0]; // Ambil file yang diunggah

            if (pjnamex == '' || pjdatex == '' || durationx == '' || platformx == '' || frontendx == '' || backendx == '' || databasesx == '' || madex == '') {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please Fill in All the requirement first !'
                });
            } else {
                console.log("Data yang diisi oleh pengguna:");
                console.log("pj_name:", pjnamex);
                console.log("pj_date:", pjdatex);
                console.log("duration:", durationx);
                console.log("platform:", platformx);
                console.log("frontend:", frontendx);
                console.log("backend:", backendx);
                console.log("databases:", databasesx);
                console.log("made_by:", madex);
                console.log("pj_yt:", pjytx);
                console.log("pj_gd:", pjgdx);
                console.log("keterangan:", ketx);
                console.log("ref_by:", refx);

                console.log("File yang diunggah:");
                console.log("Nama File:", fileInput.name);
                console.log("Tipe File:", fileInput.type);

                var formData = new FormData(); // Buat objek FormData untuk mengirim data termasuk file
                formData.append('file', fileInput); // Tambahkan file ke FormData
                formData.append('pj_name', pjnamex);
                formData.append('pj_date', pjdatex);
                formData.append('duration', durationx);
                formData.append('platform', platformx);
                formData.append('frontend', frontendx);
                formData.append('backend', backendx);
                formData.append('databases', databasesx);
                formData.append('made_by', madex);
                formData.append('pj_yt', pjytx);
                formData.append('pj_gd', pjgdx);
                formData.append('keterangan', ketx);
                formData.append('ref_by', refx);

                Swal.fire({
                    title: 'Add New Project?',
                    text: "Are you sure for this action?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#28a745',
                    cancelButtonColor: '#dc3545',
                    confirmButtonText: 'Yes!',
                    cancelButtonText: 'No!',
                    showLoaderOnConfirm: true,
                    preConfirm: function () {
                        return new Promise(function (resolve, reject) {
                            $.ajax({
                                type: "POST",
                                url: "@Url.Action("AddProject", "Admin")",
                                data: formData, // Kirim data menggunakan FormData
                                contentType: false, // Set contentType ke false agar FormData tidak diubah secara otomatis
                                processData: false, // Set processData ke false agar FormData tidak diubah secara otomatis
                                success: function (data) {
                                    Swal.fire(
                                        'Added!',
                                        'New Project has been Added.',
                                        'success'
                                    );
                                    window.location.href = '@Url.Action("ProjectHistory", "Admin")';
                                },
                                complete: function () {
                                    $('#spinner_loading').hide();
                                }
                            });

                        })
                    }
                })
            }
        });

    </script>
    <style>
        label.actual-btn {
            display: inline-block;
            background-color: #ffc107;
            color: white;
            padding: 0.5rem;
            font-family: sans-serif;
            border-radius: 0.3rem;
            cursor: pointer;
            margin-top: 1rem;
            width: 10rem;
            text-align: center;
        }

        #file-chosen {
            margin-left: 0.3rem;
            font-family: sans-serif;
        }

        label.actual-btnn {
            display: inline-block;
            background-color: #ffc107;
            color: white;
            padding: 0.5rem;
            font-family: sans-serif;
            border-radius: 0.3rem;
            cursor: pointer;
            margin-top: 1rem;
            width: 10rem;
            text-align: center;
        }

        #file-chosenn {
            margin-left: 0.3rem;
            font-family: sans-serif;
        }

        .modal-dialog {
            max-width: 110% !important;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        .modal {
            padding-right: 4px !important;
            padding: .5%;
        }

        .container {
            display: block;
            position: relative;
            padding-left: 35px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 12px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
}



